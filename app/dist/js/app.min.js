/*! app.js 2015-10-26 */
"use strict";angular.module("myApp",["ngRoute","firebase","myApp.authentification","myApp.homepage","myApp.wall","myApp.view2","myApp.version","myApp.login-logout","myApp.addPost","myApp.wallDirective"]).run(["$rootScope","$location",function(a,b){a.$on("$routeChangeError",function(a,c,d,e){"AUTH_REQUIRED"===e&&b.path("/login")})}]).filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}).controller("addMessageController",["$scope","$firebaseObject",function(a,b){a.showMessages=function(){var b=[],c=new Firebase("https://which-one.firebaseio.com/comments/");c.orderByChild("postId").equalTo(a.authData.post).on("child_added",function(c){b.push(c.val()),a.$apply()}),a.messagesArray=b},a.addComments=function(){var b=new Firebase("https://which-one.firebaseio.com/comments/"),c=+new Date,d={message:a.authData.userMessage,postId:a.authData.post,userId:a.authData.uid,firstname:a.authData.firstname,date:c};console.log(d),b.push(d,function(a){a?console.log(a):console.log("comment saved!")}),$("#message").val("")}}]),angular.module("myApp.addPost",["firebase"]).controller("addPostController",["$scope","$firebaseObject",function(a,b){a.createPost=function(){var b=$("#post-first-file").val(),c=$("#post-second-file").val(),d=new Firebase("https://which-one.firebaseio.com/posts/"),e=+new Date,f={title:a.postTitle,description:a.postDescription,firstTitle:a.firstTitle,fileOne:b,secondTitle:a.secondTitle,fileTwo:c,userId:a.authData.uid,totalVote:0,voteOne:0,voteTwo:0,date:e,firstname:a.authData.firstname};d.push(f,function(a){a?console.log(a):console.log("post saved!")}),$("#postModal").modal("toggle")}}]),angular.module("myApp.authentification",["firebase"]).factory("Auth",["$firebaseAuth",function(a){var b=new Firebase("https://which-one.firebaseio.com");return a(b)}]).controller("authTest",["$scope","Auth","$firebaseObject","$location",function(a,b,c,d){a.auth=b,b.$onAuth(function(b){if(b){var d=new Firebase("https://which-one.firebaseio.com/"),e=c(d.child("users").child(b.uid));a.authData=e}}),a.logout=function(){b.$unauth(),a.authData=!1}}]).controller("authController",["$scope","Auth","$location","$firebaseObject",function(a,b,c,d){a.createUser=function(){a.message=null,a.error=null,b.$createUser({email:a.email,password:a.password}).then(function(e){a.message="User created with uid: "+e.uid;var f=new Firebase("https://which-one.firebaseio.com/users/"+e.uid),g=d(f);g.firstname=a.firstname,g.lastname=a.lastname,g.email=a.email,g.uid=e.uid,g.$save().then(function(){console.log("user saved!")})["catch"](function(a){console.log("Error!")}),b.$authWithPassword({email:a.email,password:a.password}).then(function(a){c.path("/wall")})["catch"](function(b){console.error("Authentication failed:",b),a.error=b})})["catch"](function(b){a.error=b})},a.removeUser=function(){a.message=null,a.error=null,b.$removeUser({email:a.email,password:a.password}).then(function(){a.message="User removed"})["catch"](function(b){a.error=b})}}]).controller("login",["$scope","Auth","$location",function(a,b,c){a.login=function(){a.authData=null,a.error=null,b.$authWithPassword({email:a.email,password:a.password}).then(function(a){c.path("/wall")})["catch"](function(b){console.error("Authentication failed:",b),a.error=b})}}]),angular.module("myApp.homepage",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"view/home/home.html",controller:"homepage"})}]).controller("homepage",["$scope","$firebaseObject",function(a,b){var c=new Firebase("https://which-one.firebaseio.com/results"),d=b(c);d.$bindTo(a,"data")}]),angular.module("myApp.login-logout",["ngRoute"]).config(["$routeProvider",function(a){a.when("/login",{templateUrl:"view/login-logout/login-logout.html"})}]),angular.module("myApp.view2",["ngRoute"]).config(["$routeProvider",function(a){a.when("/view2",{templateUrl:"view/view2/view2.html",controller:"View2Ctrl",resolve:{currentAuth:["Auth",function(a){return a.$requireAuth()}]}})}]).controller("View2Ctrl",[function(){}]),angular.module("myApp.wallDirective",[]).directive("postElement",function(){return{restrict:"AE",replace:"true",templateUrl:"view/wall/post.html"}}),angular.module("myApp.wall",["ngRoute"]).config(["$routeProvider",function(a){a.when("/wall",{templateUrl:"view/wall/wall.html",controller:"wallCtrl",resolve:{currentAuth:["Auth",function(a){return a.$requireAuth()}]}})}]).controller("wallCtrl",["$scope","$firebaseObject","$firebaseArray",function(a,b,c){var d=new Firebase("https://which-one.firebaseio.com/posts"),e=b(d);e.$bindTo(a,"data"),a.hasVoted=function(a,b){for(var c in b.voters)if(b.voters[c]===a)return!0;return!1},a.vote=function(a,b){a.totalVote++,"one"===b?a.voteOne++:a.voteTwo++},a.updateVote=function(a,b){var d=new Firebase("https://which-one.firebaseio.com/users/"+b+"/voters"),e=c(d);e.$add(a).then(function(){console.log("voter saved!")})["catch"](function(a){console.log("Error!")})}}]);